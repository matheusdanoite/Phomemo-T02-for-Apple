import{r as m,j as r,a as D,c as H,d as M,s as k,b as P}from"./firebaseConfig-BnFT8Uei.js";const C=(x,c={algorithm:"floyd-steinberg",threshold:128})=>new Promise((d,u)=>{const h=new FileReader;h.onload=j=>{const o=new Image;o.onload=()=>{let a,v;const b=o.width>o.height,p=document.createElement("canvas"),n=p.getContext("2d");b?(v=384/o.height,a=Math.floor(o.width*v),p.width=384,p.height=a,n.fillStyle="#FFFFFF",n.fillRect(0,0,384,a),n.translate(384,0),n.rotate(90*Math.PI/180),n.drawImage(o,0,0,a,384)):(v=384/o.width,a=Math.floor(o.height*v),p.width=384,p.height=a,n.fillStyle="#FFFFFF",n.fillRect(0,0,384,a),n.drawImage(o,0,0,384,a));const S=n.getImageData(0,0,384,a),t=S.data,f=384,w=a,e=c.threshold||128;if(c.algorithm==="threshold")for(let s=0;s<t.length;s+=4){const l=t[s]*.299+t[s+1]*.587+t[s+2]*.114<e?0:255;t[s]=l,t[s+1]=l,t[s+2]=l}else for(let s=0;s<w;s++)for(let g=0;g<f;g++){const l=(s*f+g)*4,W=t[l]*.299+t[l+1]*.587+t[l+2]*.114;if(c.algorithm==="halftone"){const R=([[1,9,3,11],[13,5,15,7],[4,12,2,10],[16,8,14,6]][g%4][s%4]/17-.5)*255,N=e+R,E=W<N?0:255;t[l]=E,t[l+1]=E,t[l+2]=E}else{const y=W<e?0:255,F=W-y;t[l]=y,t[l+1]=y,t[l+2]=y,I(t,f,w,g+1,s,F,7/16),I(t,f,w,g-1,s+1,F,3/16),I(t,f,w,g,s+1,F,5/16),I(t,f,w,g+1,s+1,F,1/16)}}n.putImageData(S,0,0),d({dataUrl:p.toDataURL("image/png"),isRotated:b})},o.onerror=u,o.src=j.target.result},h.onerror=u,h.readAsDataURL(x)});function I(x,c,d,u,h,j,o){if(u<0||u>=c||h<0||h>=d)return;const i=(h*c+u)*4,a=x[i]+j*o;x[i]=a,x[i+1]=a,x[i+2]=a}function A({onBack:x,initialFile:c}){const[d,u]=m.useState(null),[h,j]=m.useState(!1),[o,i]=m.useState("idle"),[a,v]=m.useState(c||null);m.useEffect(()=>{c&&v(c)},[c]);const[b,p]=m.useState("floyd-steinberg"),[n,S]=m.useState(128);m.useEffect(()=>{a&&t(a)},[b,n,a]);const t=async e=>{i("processing");try{const s=await C(e,{algorithm:b,threshold:n});u(s.dataUrl),j(s.isRotated),i("idle")}catch(s){console.error(s),i("error"),alert("Error processing image")}},f=e=>{e.target.files&&e.target.files[0]&&v(e.target.files[0])},w=async()=>{if(d){if(i("uploading"),window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.printHandler){try{const e=d.split(",")[1];window.webkit.messageHandlers.printHandler.postMessage({base64:e,type:"image_render"}),i("success"),setTimeout(()=>i("idle"),2e3)}catch(e){console.error(e),i("error"),alert("Error sending to iOS: "+e.message)}return}try{const e=d.split(",")[1];await D(H(M,"print_jobs"),{data:e,timestamp:k(),status:"pending"}),i("success"),setTimeout(()=>i("idle"),3e3)}catch(e){console.error(e),i("error"),alert("Error sending print job: "+e.message)}}};return r.jsxs("div",{className:"container",children:[r.jsx("h1",{style:{fontSize:"2.6rem"},children:"Imagens"}),r.jsxs("div",{style:{marginBottom:"20px"},children:[r.jsx("input",{type:"file",accept:"image/*",onChange:f,style:{display:"none"},id:"file-upload"}),r.jsx("label",{htmlFor:"file-upload",className:"print-button",style:{display:"inline-block",cursor:"pointer",maxWidth:"200px",fontSize:"1rem",padding:"0.8rem"},children:"Selecionar Imagem"})]}),a&&r.jsxs("div",{className:"controls-section",children:[r.jsxs("div",{className:"control-group",children:[r.jsx("label",{children:"Algoritmo:"}),r.jsxs("select",{value:b,onChange:e=>p(e.target.value),children:[r.jsx("option",{value:"floyd-steinberg",children:"Floyd-Steinberg (Dithering)"}),r.jsx("option",{value:"halftone",children:"Halftone"}),r.jsx("option",{value:"threshold",children:"Preto e Branco"})]})]}),r.jsxs("div",{className:"control-group",children:[r.jsx("label",{children:"Intensidade"}),r.jsx("input",{type:"range",min:"0",max:"255",value:n,onChange:e=>S(parseInt(e.target.value))})]})]}),d&&r.jsxs("div",{className:"preview-section",children:[r.jsx("img",{src:d,alt:"Preview",className:"preview-image",style:h?{transform:"rotate(-90deg)",maxHeight:"60vh",width:"auto",border:"1px solid #ccc"}:{}}),r.jsx("button",{onClick:w,disabled:o==="uploading",className:"print-button",children:o==="uploading"?"Enviando...":"Imprimir"})]}),o==="success"&&r.jsx("div",{className:"success-message",children:"Arquivo enviado!"}),o==="error"&&r.jsx("div",{className:"error-message",children:"Falha ao enviar arquivo."})]})}P.createRoot(document.getElementById("root")).render(r.jsx(m.StrictMode,{children:r.jsx(A,{})}));
